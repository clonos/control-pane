"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Utilities_1 = __importDefault(require("./Utilities"));
class BaseBrowser {
    flags;
    userDataDir;
    constructor(flags, userDataDir) {
        this.flags = flags;
        this.userDataDir = userDataDir;
        this._getOptions = this._getOptions.bind(this);
        this._getHeadlessOptions = this._getHeadlessOptions.bind(this);
    }
    _getOptions(url) {
        // Chrome CLI options - http://peter.sh/experiments/chromium-command-line-switches/
        this.flags.forEach((flag, i) => {
            if (Utilities_1.default.isJSFlags(flag)) {
                this.flags[i] = Utilities_1.default.sanitizeJSFlags(flag);
            }
        });
        let allflags = [
            "--user-data-dir=" + this.userDataDir,
            // https://github.com/GoogleChrome/chrome-launcher/blob/master/docs/chrome-flags-for-tools.md#--enable-automation
            "--enable-automation",
            "--no-default-browser-check",
            "--no-first-run",
            "--disable-default-apps",
            "--disable-popup-blocking",
            "--disable-background-timer-throttling",
            // on macOS, disable-background-timer-throttling is not enough
            // and we need disable-renderer-backgrounding too
            // see https://github.com/karma-runner/karma-chrome-launcher/issues/123
            "--disable-renderer-backgrounding",
            "--disable-device-discovery-notifications",
            "--mute-audio",
        ].concat(this.flags, [url]);
        return allflags;
    }
    _getHeadlessOptions(url) {
        let mergedArgs = this._getOptions(url);
        // Adding Headless flag
        // If there is arg with --headless=new or --headless=old, don't add --headless flag
        mergedArgs = mergedArgs.some((flag) => flag.indexOf("--headless=") !== -1)
            ? mergedArgs
            : mergedArgs.concat(["--headless"]);
        // Add other flags to support headless mode
        mergedArgs = mergedArgs.concat([
            "--no-proxy-server",
            //'--no-sandbox',
            //'--disable-gpu',
        ]);
        // Add remote debugging port
        mergedArgs = mergedArgs.some((flag) => flag.indexOf("--remote-debugging-port=") !== -1)
            ? mergedArgs
            : mergedArgs.concat(["--remote-debugging-port=9222"]);
        return mergedArgs;
    }
}
exports.default = BaseBrowser;
